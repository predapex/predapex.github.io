<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interactive Tank‑Pump System (Embedded Valve Images)</title>
<style>
  body{font-family:sans-serif;text-align:center;margin:0}
  button{margin:12px 6px;padding:8px 18px;font-size:18px;border:none;border-radius:8px;background:#e5e9f0;color:#036;cursor:pointer}
  button:hover{background:#d8dee9}
  #canvas{position:relative;width:820px;height:680px;margin:auto}
  svg{position:absolute;top:0;left:0}
  .pipe{stroke:#777;stroke-width:10;stroke-linecap:round;fill:none}
  .flow{stroke:#39f;stroke-width:6;stroke-dasharray:12 8;stroke-dashoffset:0;opacity:0;fill:none;pointer-events:none}
  .flow.active{opacity:1;animation:dash 1s linear infinite}
  @keyframes dash{to{stroke-dashoffset:-20}}
  .valve-img{cursor:pointer;pointer-events:auto;width:40px;height:40px}
</style>
</head>
<body>
<h2>Interactive Tank‑Pump System (Embedded Valve Images)</h2>
<button onclick="togglePump()">Pump: <span id="pumpState">OFF</span></button>
<button onclick="resetAll()">Reset Valves</button>

<div id="canvas">
  <!-- static plumbing -->
  <svg width="820" height="680">
    <line class="pipe" x1="90"  y1="200" x2="730" y2="200"/>
    <line class="pipe" x1="90"  y1="460" x2="730" y2="460"/>
    <line class="pipe" x1="410" y1="200" x2="410" y2="300"/>
    <line class="pipe" x1="410" y1="380" x2="410" y2="460"/>
    <g id="botFlows"></g>
    <path id="coreFlow" class="flow" d="M410,380 V300"/>
    <g id="topFlows"></g>
  </svg>

  <!-- pump photo (external file) -->
  <img src="pump.png" style="position:absolute;left:305px;top:285px;width:210px;height:100px;pointer-events:none">
</div>

<script>
/* ――― embedded valve PNGs (32×32) ――― */
const closedSrc="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCI+PGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNkMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PC9zdmc+";
const openSrc  ="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCI+PGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiMwYTAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PC9zdmc+";
/* valve positions */
const xs=[150,310,470,630];
const openTop=new Set(),openBot=new Set();
let pumpOn=false;

const canvas=document.getElementById('canvas');
const svg=document.querySelector('svg');
const botG=document.getElementById('botFlows');
const topG=document.getElementById('topFlows');
const pumpState=document.getElementById('pumpState');

/* build valves, pipes, flow paths */
xs.forEach((x,i)=>{
  const id=i+1;
  addPipe(x,160,x,200); addPipe(x,120,x,160);   // top branch
  addPipe(x,500,x,460); addPipe(x,500,x,540);   // bottom branch
  addFlow(botG,'b'+id,`M${x},540 V500 V460 H410 V380`);
  addFlow(topG,'t'+id,`M410,300 V200 H${x} V160`);
  addValve(x-20,160-20,'top',id);
  addValve(x-20,500-20,'bot',id);
});

function addPipe(x1,y1,x2,y2){
  let l=document.createElementNS('http://www.w3.org/2000/svg','line');
  l.setAttribute('class','pipe');l.setAttribute('x1',x1);l.setAttribute('y1',y1);
  l.setAttribute('x2',x2);l.setAttribute('y2',y2);svg.appendChild(l);
}
function addFlow(parent,id,d){
  let p=document.createElementNS('http://www.w3.org/2000/svg','path');
  p.setAttribute('id',id);p.setAttribute('d',d);p.setAttribute('class','flow');parent.appendChild(p);
}
function addValve(left,top,side,id){
  let img=document.createElement('img');
  img.src=closedSrc; img.className='valve-img closed';
  img.dataset.side=side; img.dataset.id=id;
  Object.assign(img.style,{position:'absolute',left:left+'px',top:top+'px'});
  img.onclick=valveToggle; canvas.appendChild(img);
}

function valveToggle(e){
  let img=e.currentTarget, side=img.dataset.side, id=+img.dataset.id;
  let set=side==='top'?openTop:openBot;
  if(set.has(id)){set.delete(id); img.src=closedSrc; img.classList.replace('open','closed');}
  else{set.add(id); img.src=openSrc; img.classList.replace('closed','open');}
  update();
}
function togglePump(){pumpOn=!pumpOn;pumpState.textContent=pumpOn?'ON':'OFF';update();}
function resetAll(){
  document.querySelectorAll('.valve-img.open')
    .forEach(v=>{v.src=closedSrc; v.classList.replace('open','closed');});
  openTop.clear();openBot.clear();pumpOn=false;pumpState.textContent='OFF';update();
}
function update(){
  document.getElementById('coreFlow').classList.toggle('active',pumpOn&&openTop.size&&openBot.size);
  xs.forEach((x,i)=>{
    const id=i+1;
    document.getElementById('t'+id).classList.toggle('active',pumpOn&&openTop.has(id)&&openBot.size);
    document.getElementById('b'+id).classList.toggle('active',pumpOn&&openBot.has(id)&&openTop.size);
  });
}
</script>
</body>
</html>
