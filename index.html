<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><title>Interactive Tank-Pump System</title>
<style>
 body{font-family:sans-serif;text-align:center;margin:0}
 button{margin:12px 6px;padding:8px 18px;font-size:18px;border:none;border-radius:8px;background:#e5e9f0;color:#036;cursor:pointer}
 button:hover{background:#d8dee9}
 svg{user-select:none}
 .pipe{stroke:#777;stroke-width:10;stroke-linecap:round;fill:none}
 .pump{fill:#666;stroke:#444;stroke-width:2}
 .valve.closed rect{fill:#d00}
 .valve.open  rect{fill:#0a0}
 .valve text{pointer-events:none;font-size:18px;fill:#fff;font-weight:bold}
 .flow{stroke:#39f;stroke-width:6;stroke-dasharray:12 8;stroke-dashoffset:0;opacity:0;fill:none;pointer-events:none}
 .flow.active{opacity:1;animation:dash 1s linear infinite}
 @keyframes dash{to{stroke-dashoffset:-20}}
</style>
</head>
<body>
<h2 style="margin-top:20px">Interactive Tank-Pump System</h2>
<button onclick="togglePump()">Pump: <span id="pumpState">OFF</span></button>
<button onclick="resetAll()">Reset Valves</button>

<svg width="820" height="680">
 <!-- manifolds -->
 <line class="pipe" x1="90" y1="200" x2="730" y2="200"/>
 <line class="pipe" x1="90" y1="460" x2="730" y2="460"/>

 <!-- pump -->
 <rect class="pump" x="310" y="300" rx="20" ry="20" width="200" height="80"/>
 <text x="410" y="345" text-anchor="middle" font-size="26" fill="#fff">Pump</text>
 <line class="pipe" x1="410" y1="200" x2="410" y2="300"/>
 <line class="pipe" x1="410" y1="380" x2="410" y2="460"/>

 <!-- flow groups -->
 <g id="flowsBot"></g>
 <path id="flowPump" class="flow" d="M410,380 V300"/>
 <g id="flowsTop"></g>
</svg>

<script>
const xs=[150,310,470,630];            // valve x-positions
const openTop=new Set(),openBot=new Set();
let pumpOn=false;
const pumpState=document.getElementById('pumpState');
const svg=document.querySelector('svg');
const fTop=document.getElementById('flowsTop');
const fBot=document.getElementById('flowsBot');

/* build valves, branch pipes, and flow paths */
xs.forEach((x,i)=>{
 const id=i+1;
 // branch pipes
 addPipe(x,160,x,200); addPipe(x,120,x,160); // top stub+ext
 addPipe(x,500,x,460); addPipe(x,500,x,540); // bottom stub+ext

 // flows (bot → pump-in)
 addFlow(fBot,`bot${id}`,`M${x},500 V460 H410 V380`);
 // flows (pump-out → top)
 addFlow(fTop,`top${id}`,`M410,300 H${x} V160`);

 // valves
 addValve(x,160,'top',id);
 addValve(x,500,'bot',id);
});

/* helper builders */
function addPipe(x1,y1,x2,y2){
 const l=document.createElementNS('http://www.w3.org/2000/svg','line');
 l.setAttribute('class','pipe');l.setAttribute('x1',x1);l.setAttribute('y1',y1);
 l.setAttribute('x2',x2);l.setAttribute('y2',y2);svg.appendChild(l);
}
function addFlow(parent,id,d){
 const p=document.createElementNS('http://www.w3.org/2000/svg','path');
 p.setAttribute('id',id);p.setAttribute('d',d);p.setAttribute('class','flow');parent.appendChild(p);
}
function addValve(x,y,side,id){
 const g=document.createElementNS('http://www.w3.org/2000/svg','g');
 g.classList.add('valve','closed');g.dataset.side=side;g.dataset.id=id;g.onclick=toggleValve;
 const r=document.createElementNS('http://www.w3.org/2000/svg','rect');
 r.setAttribute('x',x-20);r.setAttribute('y',y-20);r.setAttribute('width',40);r.setAttribute('height',40);r.setAttribute('rx',5);
 const t=document.createElementNS('http://www.w3.org/2000/svg','text');
 t.setAttribute('x',x);t.setAttribute('y',y+6);t.setAttribute('text-anchor','middle');t.textContent=id;
 g.appendChild(r);g.appendChild(t);svg.appendChild(g);
}

/* interaction */
function toggleValve(e){
 const {side,id}=e.currentTarget.dataset;
 const set=side==='top'?openTop:openBot;
 if(set.has(+id)){set.delete(+id);e.currentTarget.classList.replace('open','closed');}
 else{set.add(+id);e.currentTarget.classList.replace('closed','open');}
 updateFlows();
}
function togglePump(){pumpOn=!pumpOn;pumpState.textContent=pumpOn?'ON':'OFF';updateFlows();}
function resetAll(){
 document.querySelectorAll('.valve.open').forEach(v=>v.classList.replace('open','closed'));
 openTop.clear();openBot.clear();pumpOn=false;pumpState.textContent='OFF';updateFlows();
}
function updateFlows(){
 // pump core segment
 const coreActive=pumpOn&&openTop.size&&openBot.size;
 document.getElementById('flowPump').classList.toggle('active',coreActive);

 xs.forEach((x,i)=>{
   const id=i+1;
   document.getElementById(`top${id}`).classList.toggle('active',pumpOn&&openTop.has(id)&&openBot.size);
   document.getElementById(`bot${id}`).classList.toggle('active',pumpOn&&openBot.has(id)&&openTop.size);
 });
}
</script>
</body>
</html>
