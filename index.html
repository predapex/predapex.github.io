<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Interactive Pump Diagram</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }

    .valve {
      cursor: pointer;
      fill: red;
      stroke: black;
      stroke-width: 1;
    }

    .valve-label {
      fill: white;
      font-size: 12px;
      font-weight: bold;
      pointer-events: none;
    }

    .pump {
      fill: #777;
    }

    .pipe {
      stroke: rgba(100,100,100,0.3);
      stroke-width: 8;
      fill: none;
    }

    .flow-line {
      stroke: blue;
      stroke-width: 2;
      stroke-dasharray: 4, 4;
      opacity: 0;
      animation: dash 1s linear infinite;
    }

    .flow-active {
      opacity: 1;
    }

    @keyframes dash {
      0% { stroke-dashoffset: 0; }
      100% { stroke-dashoffset: -16; }
    }

    button {
      margin: 10px;
    }

    .label-text {
      font-size: 14px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Interactive Pump Diagram</h2>
  <button onclick="togglePump()">Pump: <span id="pumpState">OFF</span></button>
  <button onclick="resetValves()">Reset Valves</button>
  <svg width="800" height="600">
    <text x="100" y="100" class="label-text">From Tanks</text>
    <text x="640" y="100" class="label-text">To Tanks</text>
    <text x="100" y="400" class="label-text">Suction</text>
    <text x="640" y="400" class="label-text">Return</text>

    <line x1="200" y1="160" x2="200" y2="360" class="pipe"/>
    <line x1="600" y1="160" x2="600" y2="360" class="pipe"/>
    <line x1="200" y1="260" x2="360" y2="260" class="pipe"/>
    <line x1="600" y1="260" x2="440" y2="260" class="pipe"/>

    <circle cx="400" cy="260" r="30" class="pump"/>
    <text x="400" y="265" text-anchor="middle" fill="white">Pump</text>

    <!-- Valves -->
    <script>
      const valveCount = 4;
      for (let i = 1; i <= valveCount; i++) {
        document.write(`
          <rect x="150" y="${140 + (i - 1) * 60}" width="30" height="30" rx="4" class="valve" onclick="toggleValve(${i}, 'left')" id="valve-left-${i}"/>
          <text x="165" y="${160 + (i - 1) * 60}" text-anchor="middle" class="valve-label">${i}</text>
          <line x1="150" y1="${155 + (i - 1) * 60}" x2="120" y2="${155 + (i - 1) * 60}" class="pipe"/>
          <line x1="180" y1="${155 + (i - 1) * 60}" x2="200" y2="${155 + (i - 1) * 60}" class="pipe"/>

          <rect x="620" y="${140 + (i - 1) * 60}" width="30" height="30" rx="4" class="valve" onclick="toggleValve(${i}, 'right')" id="valve-right-${i}"/>
          <text x="635" y="${160 + (i - 1) * 60}" text-anchor="middle" class="valve-label">${i}</text>
          <line x1="620" y1="${155 + (i - 1) * 60}" x2="600" y2="${155 + (i - 1) * 60}" class="pipe"/>
          <line x1="650" y1="${155 + (i - 1) * 60}" x2="680" y2="${155 + (i - 1) * 60}" class="pipe"/>

          <line x1="200" y1="${155 + (i - 1) * 60}" x2="360" y2="260" class="flow-line" id="flow-left-${i}"/>
          <line x1="440" y1="260" x2="600" y2="${155 + (i - 1) * 60}" class="flow-line" id="flow-right-${i}"/>
        `);
      }
    </script>
  </svg>
  <script>
    let pumpOn = false;
    const activeValves = { left: new Set(), right: new Set() };

    function togglePump() {
      pumpOn = !pumpOn;
      document.getElementById('pumpState').innerText = pumpOn ? 'ON' : 'OFF';
      updateFlow();
    }

    function toggleValve(n, side) {
      const valve = document.getElementById(`valve-${side}-${n}`);
      if (activeValves[side].has(n)) {
        activeValves[side].delete(n);
        valve.setAttribute("fill", "red");
      } else {
        activeValves[side].add(n);
        valve.setAttribute("fill", "green");
      }
      updateFlow();
    }

    function resetValves() {
      for (let side of ['left', 'right']) {
        for (let n of activeValves[side]) {
          const valve = document.getElementById(`valve-${side}-${n}`);
          valve.setAttribute("fill", "red");
        }
        activeValves[side].clear();
      }
      updateFlow();
    }

    function updateFlow() {
      for (let i = 1; i <= 4; i++) {
        const show = pumpOn && activeValves.left.has(i) && activeValves.right.has(i);
        document.getElementById(`flow-left-${i}`).setAttribute("class", show ? "flow-line flow-active" : "flow-line");
        document.getElementById(`flow-right-${i}`).setAttribute("class", show ? "flow-line flow-active" : "flow-line");
      }
    }
  </script>
</body>
</html>
